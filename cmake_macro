# pushd ..
# sd "flto=full" "flto=16" -r "*.cmake"
# popd
cmake -G Ninja ../llvm \
    -DBUILD_SHARED_LIBS:BOOL=OFF \
    -DLIB_INSTALL_DIR=%{_libdir} \
    -DLIB_SUFFIX=64 \
    -DLLVM_LIBDIR_SUFFIX=64 \
    -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_C_COMPILER=gcc \
    -DCMAKE_CXX_COMPILER=g++ \
    -DCMAKE_INSTALL_LIBDIR=%{_libdir} \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_INSTALL_SBINDIR=%{_sbindir} \
    -DLLVM_PARALLEL_COMPILE_JOBS:STRING=16 \
    -DLLVM_PARALLEL_LINK_JOBS:STRING=6 \
    -DCMAKE_AR=/usr/bin/gcc-ar \
    -DCMAKE_NM=/usr/bin/gcc-nm \
    -DCMAKE_RANLIB=/usr/bin/gcc-ranlib \
    -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON \
    -DENABLE_LINKER_BUILD_ID:BOOL=ON \
    -DCLANG_BUILD_TOOLS:BOOL=ON \
    -DCLANG_DEFAULT_LINKER=lld \
    -DLLVM_ENABLE_LIBCXX:BOOL=OFF \
    -DLLVM_STATIC_LINK_CXX_STDLIB:BOOL=ON \
    -DCLANG_DEFAULT_CXX_STDLIB:STRING=libstdc++ \
    -DCLANG_ENABLE_STATIC_ANALYZER:BOOL=ON \
    -DCLANG_INCLUDE_TESTS:BOOL=OFF \
    -DCLANG_LINK_CLANG_DYLIB:BOOL=OFF \
    -DLLVM_LINK_LLVM_DYLIB:BOOL=OFF \
    -DLLVM_BUILD_LLVM_DYLIB:BOOL=ON \
    -DLIBCLANG_BUILD_STATIC:BOOL=ON \
    -DCOMPILER_RT_BUILD_SANITIZERS:BOOL=OFF \
    -DCOMPILER_RT_BUILD_XRAY:BOOL=OFF \
    -DLLVM_BINUTILS_INCDIR=/usr/include \
    -DLLVM_BUILD_EXAMPLES:BOOL=OFF \
    -DLLVM_BUILD_RUNTIME:BOOL=ON \
    -DLLVM_BUILD_TOOLS:BOOL=ON \
    -DLLVM_BUILD_UTILS:BOOL=ON \
    -DLLVM_ENABLE_ASSERTIONS:BOOL=ON \
    -DLLVM_ENABLE_BINDINGS:BOOL=OFF \
    -DLLVM_ENABLE_DOXYGEN:BOOL=OFF \
    -DLLVM_ENABLE_EH:BOOL=ON \
    -DLLVM_ENABLE_LIBXML2:BOOL=ON \
    -DLLVM_ENABLE_RTTI:BOOL=ON \
    -DLLVM_REQUIRES_RTTI:BOOL=ON \
    -DLLVM_ENABLE_THREADS:BOOL=ON \
    -DLLVM_ENABLE_Z3_SOLVER:BOOL=ON \
    -DLLVM_ENABLE_LIBEDIT:BOOL=OFF \
    -DLLVM_ENABLE_TERMINFO:BOOL=OFF \
    -DLLVM_ENABLE_ZLIB:BOOL=ON \
    -DLLVM_ENABLE_FFI:BOOL=ON \
    -DFFI_INCLUDE_DIR=`pkg-config --variable=includedir libffi` \
    -DCLANG_ENABLE_ARCMT:BOOL=OFF \
    -DLLVM_INCLUDE_TESTS:BOOL=OFF \
    -DLLVM_INCLUDE_TOOLS:BOOL=ON \
    -DLLVM_INSTALL_UTILS:BOOL=ON \
    -DCMAKE_DISABLE_FIND_PACKAGE_CUDA:BOOL=ON \
    -DLLVM_OPTIMIZED_TABLEGEN:BOOL=ON \
    -DLLVM_ENABLE_PIC=ON \
    -DLLVM_TARGETS_TO_BUILD="X86" \
    -DLLVM_TOOL_CLANG_TOOLS_EXTRA_BUILD:BOOL=ON \
    -DLLVM_TOOL_COMPILER_RT_BUILD:BOOL=OFF \
    -DLLVM_USE_LINKER:STRING=bfd \
    -DLLVM_HOST_TRIPLE="x86_64-generic-linux" \
    -DPYTHON_EXECUTABLE:FILEPATH=/usr/bin/python3 \
    -DLLVM_ENABLE_PLUGINS:BOOL=ON \
    -DLLVM_EXPORT_SYMBOLS_FOR_PLUGINS:BOOL=ON \
    -DLLVM_ENABLE_PROJECTS="llvm;clang;clang-tools-extra;lld;parallel-libs;polly" \
    -DCMAKE_CXX_STANDARD:STRING="14" \
    -DCMAKE_C_FLAGS="-fno-stack-protector -pthread -lpthread -static-libgcc -static-libstdc++ -O3 -flto=16 --param=lto-max-streaming-parallelism=16 -ffat-lto-objects -fomit-frame-pointer -fuse-ld=bfd -fuse-linker-plugin -march=native -mtune=native -Wall -Wl,-O2 -Wl,--build-id=sha1 -Wl,-z,now -Wl,-z,relro -falign-functions=32 -flimit-function-alignment -fasynchronous-unwind-tables -malign-data=cacheline -Wl,-sort-common -fdevirtualize-at-ltrans -flifetime-dse=1 -Wl,--as-needed -fPIC -pipe -fgraphite-identity -floop-nest-optimize -floop-block -ftree-loop-distribute-patterns -ftree-loop-vectorize -ftree-vectorize -funroll-loops -Wl,-z,max-page-size=0x1000 -feliminate-unused-debug-types -fno-semantic-interposition" \
    -DCMAKE_CXX_FLAGS="-fno-stack-protector -pthread -lpthread -static-libgcc -static-libstdc++ -O3 -flto=16 --param=lto-max-streaming-parallelism=16 -ffat-lto-objects -fomit-frame-pointer -fuse-ld=bfd -fuse-linker-plugin -march=native -mtune=native -Wall -Wl,-O2 -Wl,--build-id=sha1 -Wl,-z,now -Wl,-z,relro -falign-functions=32 -flimit-function-alignment -fasynchronous-unwind-tables -malign-data=cacheline -Wl,-sort-common -fdevirtualize-at-ltrans -flifetime-dse=1 -Wl,--as-needed -fPIC -pipe -fgraphite-identity -floop-nest-optimize -floop-block -ftree-loop-distribute-patterns -ftree-loop-vectorize -ftree-vectorize -funroll-loops -Wl,-z,max-page-size=0x1000 -feliminate-unused-debug-types -fno-semantic-interposition" \
    -DCMAKE_EXE_LINKER_FLAGS="-fno-stack-protector -pthread -lpthread -static-libgcc -static-libstdc++ -O3 -flto=16 --param=lto-max-streaming-parallelism=16 -ffat-lto-objects -fomit-frame-pointer -fuse-ld=bfd -fuse-linker-plugin -march=native -mtune=native -Wall -Wl,-O2 -Wl,--build-id=sha1 -Wl,-z,now -Wl,-z,relro -falign-functions=32 -flimit-function-alignment -fasynchronous-unwind-tables -malign-data=cacheline -Wl,-sort-common -fdevirtualize-at-ltrans -flifetime-dse=1 -Wl,--as-needed -fPIC -pipe -fgraphite-identity -floop-nest-optimize -floop-block -ftree-loop-distribute-patterns -ftree-loop-vectorize -ftree-vectorize -funroll-loops -Wl,-z,max-page-size=0x1000 -feliminate-unused-debug-types -fno-semantic-interposition" \
    -DCMAKE_MODULE_LINKER_FLAGS="-fno-stack-protector -pthread -lpthread -static-libgcc -static-libstdc++ -O3 -flto=16 --param=lto-max-streaming-parallelism=16 -ffat-lto-objects -fomit-frame-pointer -fuse-ld=bfd -fuse-linker-plugin -march=native -mtune=native -Wall -Wl,-O2 -Wl,--build-id=sha1 -Wl,-z,now -Wl,-z,relro -falign-functions=32 -flimit-function-alignment -fasynchronous-unwind-tables -malign-data=cacheline -Wl,-sort-common -fdevirtualize-at-ltrans -flifetime-dse=1 -Wl,--as-needed -fPIC -pipe -fgraphite-identity -floop-nest-optimize -floop-block -ftree-loop-distribute-patterns -ftree-loop-vectorize -ftree-vectorize -funroll-loops -Wl,-z,max-page-size=0x1000 -feliminate-unused-debug-types -fno-semantic-interposition" \
    -DCMAKE_SHARED_LINKER_FLAGS="-fno-stack-protector -pthread -lpthread -static-libgcc -static-libstdc++ -O3 -flto=16 --param=lto-max-streaming-parallelism=16 -ffat-lto-objects -fomit-frame-pointer -fuse-ld=bfd -fuse-linker-plugin -march=native -mtune=native -Wall -Wl,-O2 -Wl,--build-id=sha1 -Wl,-z,now -Wl,-z,relro -falign-functions=32 -flimit-function-alignment -fasynchronous-unwind-tables -malign-data=cacheline -Wl,-sort-common -fdevirtualize-at-ltrans -flifetime-dse=1 -Wl,--as-needed -fPIC -pipe -fgraphite-identity -floop-nest-optimize -floop-block -ftree-loop-distribute-patterns -ftree-loop-vectorize -ftree-vectorize -funroll-loops -Wl,-z,max-page-size=0x1000 -feliminate-unused-debug-types -fno-semantic-interposition" \
    -DGCC_INSTALL_PREFIX="/usr" \
    -Wno-dev
